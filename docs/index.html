<!DOCTYPE html>

<html>
<head>
<title>Go; Design for change</title>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<style>@import url('https://fonts.googleapis.com/css?family=Inconsolata|Source+Sans+Pro');
html, body {
font-family: 'Source Sans Pro', sans-serif;
margin: 0 0;
padding: 0 0;
}
.slide {
margin: 0 0;
padding: 0 0;
text-align: center;
height: 100vh;
}
.slide header {
display: block;
border: 1px solid #cde9e9;
margin: 0 0;
background-color: #cde9e9;
vertical-align: center;
height: 10%;
}
.slide .content {
margin: 0 0;
padding: 1% 1%;
height: 80%;
overflow: auto;
}
.slide ul, p, pre {
text-align: left;
}
.slide nav {
display: block;
margin: 0 0;
padding: 0 0;
text-align: center;
clear: both;
width: 100%;
height: 5%;
}
.slide nav ul {
list-style-type: none;
margin: 0 0;
padding: 0 0;
text-align: center;
}
.slide nav ul li {
margin: 0 1px;
display: inline;
}
.slide nav ul li.current a, .slide nav ul li:hover a {
background-color: #e2e2e2;
border-radius: 5px;
}
nav a:link, nav a:visited {
color: #727272;
padding: 3px 5px;
text-decoration: none;
cursor: pointer;
}
a:link, a:visited {
color: #007d9c;
text-decoration: none;
}
a:hover {
text-decoration: underline;
}
.header {
width: 100%;
border-bottom: 1px solid #727272;
text-align: right;
margin-top: -2em;
margin-bottom: 1em;
}
h1, h2, h3 {
text-align: center;
}
.twocolumn {
width: 100%;
}
.srcfile {
margin-top: 1.6em;
margin-bottom: 1.6em;
background-image: url("printout-whole.png");
background-repeat: repeat-y;
padding-left: 36px;
background-color: #fafafa;
tab-size: 4;
-moz-tab-size: 4;
min-width: 35vw;
}
.srcfile code {
padding: .6em 0 2vh 0;
background-image: url("printout-whole.png");
background-repeat: repeat-y;
background-position: right top;
display: block;
text-align: left;
font-family: Inconsolata;
overflow: wrap;
}
.srcfile code .line {
display: block;
width: 98%;
clear: both;
margin-bottom: -1.5vh;
}
.srcfile code span:hover {
background-color: #b4eeb4;
}
.srcfile code i {
font-style: normal;
color: #a2a2a2;
}
.shell {
padding: 1em;
border-radius: 10px;
min-width: 40vw;
overflow: wrap;
}
li.h3 {
margin-left: 2em;
}
table.columns {
width: 100%;
}
.columns td {
padding: 0 1em;
width: 19%;
}
.columns .shell {
min-width: auto;
}
.dark {
background-color: #2e2e34;
color: aliceblue;
}
.light {
background-color: #ffffff;
color: #3b2616;
}
img.center {
display: block;
margin-left: auto;
margin-right: auto;
}
img.left {
float: left;
margin-right: 2em;
}
.group {
text-align: left;
margin-right: 3em;
}
.group:first-child {
margin-left: 5vw;
}
td {
vertical-align: top;
}
td:nth-child(2) {
padding-left: 2em;
}
ul.left, ol.left {
text-align: left;
}
.keyword {
color: darkviolet;
}
.type {
color: dodgerblue;
}
.comment, .comment>span {
color: darkgreen;
}
</style>
</head>
<body>
<div class="slide" id="1"><header><h2>Go; Design for change</h2>
</header>
<div class="content"><a href="#2"><img src="evotalk.png"/></a><br/><br/><br/><span>Gregory Vinčić, 2023</span><br/><br/><br/></div>
<nav><ul>
<li class="current"><a href="#1">1</a></li>
<li><a href="#2">2</a></li>
<li><a href="#3">3</a></li>
<li><a href="#4">4</a></li>
<li><a href="#5">5</a></li>
<li><a href="#6">6</a></li>
<li><a href="#7">7</a></li>
<li><a href="#8">8</a></li>
<li><a href="#9">9</a></li>
<li><a href="#10">10</a></li>
<li><a href="#11">11</a></li>
<li> | </li>
<li><a href="#12">12</a></li>
<li><a href="#13">13</a></li>
<li><a href="#14">14</a></li>
<li><a href="#15">15</a></li>
<li><a href="#16">16</a></li>
<li><a href="#17">17</a></li>
<li> | </li>
<li><a href="#18">18</a></li>
<li><a href="#19">19</a></li>
<li><a href="#20">20</a></li>
<li><a href="#21">21</a></li>
<li> | </li>
<li><a href="#22">22</a></li>
<li><a href="#23">23</a></li>
</ul>
</nav>
</div>
<div class="slide" id="2"><header><h2>Story</h2>
</header>
<div class="content"><p>From the simplest "func main" to a large service. What choices to
consider when your project grows and how to keep it on track for
future changes.<br/>We begin with hello world and then evolve it along a story path.
Along the way depending on the choices we make, the <b>design</b> of our
project will change. <em>I'll refer to directory layout, not as structure
but as design.</em></p>
<img src="people.png"/></div>
<nav><ul>
<li><a href="#1">1</a></li>
<li class="current"><a href="#2">2</a></li>
<li><a href="#3">3</a></li>
<li><a href="#4">4</a></li>
<li><a href="#5">5</a></li>
<li><a href="#6">6</a></li>
<li><a href="#7">7</a></li>
<li><a href="#8">8</a></li>
<li><a href="#9">9</a></li>
<li><a href="#10">10</a></li>
<li><a href="#11">11</a></li>
<li> | </li>
<li><a href="#12">12</a></li>
<li><a href="#13">13</a></li>
<li><a href="#14">14</a></li>
<li><a href="#15">15</a></li>
<li><a href="#16">16</a></li>
<li><a href="#17">17</a></li>
<li> | </li>
<li><a href="#18">18</a></li>
<li><a href="#19">19</a></li>
<li><a href="#20">20</a></li>
<li><a href="#21">21</a></li>
<li> | </li>
<li><a href="#22">22</a></li>
<li><a href="#23">23</a></li>
</ul>
</nav>
</div>
<div class="slide" id="3"><header><h2>func main()</h2>
</header>
<div class="content"><table class="columns">
<tr><td><p>Let's kick off our project. We'll name it "rebel" and use the repository domain
"github.com/preferit/rebel".

We choose to create a command, ie. package main. The implications for
our ability to evolve
</p>
<ol class="left">
<li>You Cannot share any logic within it with others (including
yourself), Go disallows the import of main packages</li>
<li>API documentation is hidden when using e.g. go doc, as a result of
(1)</li>
</ol>
</td><td><pre class="shell dark">$ tree rebel<br/>rebel
├── go.mod
└── main.go

0 directories, 2 files
</pre><div class="srcfile"><pre><code><span class=line><i>  1</i> <span class="comment">// Command rebel generates rebelious statement.</span></span>
<span class=line><i>  2</i> package main</span>
<span class=line><i>  3</i> </span>
<span class=line><i>  4</i> <span class="keyword">import</span> "fmt"</span>
<span class=line><i>  5</i> </span>
<span class=line><i>  6</i> <span class="keyword">func</span> main() {</span>
<span class=line><i>  7</i>     Shout()</span>
<span class=line><i>  8</i> }</span>
<span class=line><i>  9</i> </span>
<span class=line><i> 10</i> <span class="comment">// Shout writes a statement to <span class="type">os.Stdout</span></span></span>
<span class=line><i> 11</i> <span class="keyword">func</span> Shout() {</span>
<span class=line><i> 12</i>     fmt.Println("We are Rebelz!")</span>
<span class=line><i> 13</i> }</span>
<span class=line><i> 14</i> </span></code></pre></div>
</td></tr>
</table>
</div>
<nav><ul>
<li><a href="#1">1</a></li>
<li><a href="#2">2</a></li>
<li class="current"><a href="#3">3</a></li>
<li><a href="#4">4</a></li>
<li><a href="#5">5</a></li>
<li><a href="#6">6</a></li>
<li><a href="#7">7</a></li>
<li><a href="#8">8</a></li>
<li><a href="#9">9</a></li>
<li><a href="#10">10</a></li>
<li><a href="#11">11</a></li>
<li> | </li>
<li><a href="#12">12</a></li>
<li><a href="#13">13</a></li>
<li><a href="#14">14</a></li>
<li><a href="#15">15</a></li>
<li><a href="#16">16</a></li>
<li><a href="#17">17</a></li>
<li> | </li>
<li><a href="#18">18</a></li>
<li><a href="#19">19</a></li>
<li><a href="#20">20</a></li>
<li><a href="#21">21</a></li>
<li> | </li>
<li><a href="#22">22</a></li>
<li><a href="#23">23</a></li>
</ul>
</nav>
</div>
<div class="slide" id="4"><header><h2>You code along..</h2>
</header>
<div class="content"><p>This is a starting point; you have no intention to share
        any logic you only want to use the command yourself. You are
        happy and code along the nice feature of randomizing rebelious
        statements.</p>
<table>
<tr><td><div class="srcfile"><pre><code><span class=line><i>  1</i> <span class="comment">// Command rebel generates rebelious statement.</span></span>
<span class=line><i>  2</i> package main</span>
<span class=line><i>  3</i> </span>
<span class=line><i>  4</i> <span class="keyword">import</span> (</span>
<span class=line><i>  5</i>     "fmt"</span>
<span class=line><i>  6</i>     "math/rand"</span>
<span class=line><i>  7</i> )</span>
<span class=line><i>  8</i> </span>
<span class=line><i>  9</i> <span class="keyword">func</span> main() {</span>
<span class=line><i> 10</i>     Shout()</span>
<span class=line><i> 11</i> }</span>
<span class=line><i> 12</i> </span>
<span class=line><i> 13</i> <span class="comment">// Shout writes a statement to <span class="type">os.Stdout</span></span></span>
<span class=line><i> 14</i> <span class="keyword">func</span> Shout() {</span>
<span class=line><i> 15</i>     fmt.Println(RandValue(phrases))</span>
<span class=line><i> 16</i> }</span>
<span class=line><i> 17</i> </span>
<span class=line><i> 18</i> <span class="comment">// RandValue returns a random element of the given slice or the zero value.</span></span>
<span class=line><i> 19</i> <span class="keyword">func</span> RandValue[T any](slice []T) (v T) {</span>
<span class=line><i> 20</i>     <span class="keyword">if</span> len(slice) == 0 {</span>
<span class=line><i> 21</i>         <span class="keyword">return</span></span>
<span class=line><i> 22</i>     }</span>
<span class=line><i> 23</i>     i := rand.Intn(len(slice))</span>
<span class=line><i> 24</i>     <span class="keyword">return</span> slice[i]</span>
<span class=line><i> 25</i> }</span>
<span class=line><i> 26</i> </span>
<span class=line><i> 27</i> <span class="keyword">var</span> phrases = []string{</span>
<span class=line><i> 28</i>     "We are Rebelz!",</span>
<span class=line><i> 29</i>     "You may take our lives, but you will never take our freeeedooooom!",</span>
<span class=line><i> 30</i>     "We ain't gonna take it, No!, we ain't gonna take it!",</span>
<span class=line><i> 31</i> }</span>
<span class=line><i> 32</i> </span></code></pre></div>
</td><td><pre class="shell dark">$ tree rebel<br/>rebel
├── go.mod
└── main.go

0 directories, 2 files
</pre><p>At this point your coworkers Max and Lisa see
                    the work and you end up in a discussion;</p>
</td></tr>
</table>
</div>
<nav><ul>
<li><a href="#1">1</a></li>
<li><a href="#2">2</a></li>
<li><a href="#3">3</a></li>
<li class="current"><a href="#4">4</a></li>
<li><a href="#5">5</a></li>
<li><a href="#6">6</a></li>
<li><a href="#7">7</a></li>
<li><a href="#8">8</a></li>
<li><a href="#9">9</a></li>
<li><a href="#10">10</a></li>
<li><a href="#11">11</a></li>
<li> | </li>
<li><a href="#12">12</a></li>
<li><a href="#13">13</a></li>
<li><a href="#14">14</a></li>
<li><a href="#15">15</a></li>
<li><a href="#16">16</a></li>
<li><a href="#17">17</a></li>
<li> | </li>
<li><a href="#18">18</a></li>
<li><a href="#19">19</a></li>
<li><a href="#20">20</a></li>
<li><a href="#21">21</a></li>
<li> | </li>
<li><a href="#22">22</a></li>
<li><a href="#23">23</a></li>
</ul>
</nav>
</div>
<div class="slide" id="5"><header><h2>Share with friends</h2>
</header>
<div class="content"><table>
<tr><td><img src="youmaxlisa.png"/></td><td><pre>
- Max:  Would be nice to see that phrase when I login as the message of the day
- You:  Easy peasy, just go install ... and run it.
- Lisa: Can we include it on the intranet?
- You:  Hmm.. (you pause and start thinking)
- You:  Not really; you could use the binary, but it would be slow with all the
        traffic we have</pre><p>Here you are faced with a decision on how to share
                the logic of generating a random rebelious
                statement.</p>
<ol>
<li>Redesign the logic as an importable package or</li>
<li>Write a small service with an API.</li>
<li>Share the data only and let them figure it out</li>
</ol>
<p>The first and second option will both require some
               effort. As the consumers are your friiends the first
               seems more fitting and much easier to do. The third
               option, though viable, does not help this presentation
               :-).</p>
</td></tr>
</table>
</div>
<nav><ul>
<li><a href="#1">1</a></li>
<li><a href="#2">2</a></li>
<li><a href="#3">3</a></li>
<li><a href="#4">4</a></li>
<li class="current"><a href="#5">5</a></li>
<li><a href="#6">6</a></li>
<li><a href="#7">7</a></li>
<li><a href="#8">8</a></li>
<li><a href="#9">9</a></li>
<li><a href="#10">10</a></li>
<li><a href="#11">11</a></li>
<li> | </li>
<li><a href="#12">12</a></li>
<li><a href="#13">13</a></li>
<li><a href="#14">14</a></li>
<li><a href="#15">15</a></li>
<li><a href="#16">16</a></li>
<li><a href="#17">17</a></li>
<li> | </li>
<li><a href="#18">18</a></li>
<li><a href="#19">19</a></li>
<li><a href="#20">20</a></li>
<li><a href="#21">21</a></li>
<li> | </li>
<li><a href="#22">22</a></li>
<li><a href="#23">23</a></li>
</ul>
</nav>
</div>
<div class="slide" id="6"><header><h2>First attempt at redesign</h2>
</header>
<div class="content"><p>How do you convert the current state, a command, into an
        importable package while also keeping the command. First
        attempt; keep command in root and create a package with logic
        to generate the phrases.</p>
<table>
<tr><td><pre class="shell dark">$ tree rebel<br/>rebel
├── go.mod
├── main.go
└── phrase
    └── phrase.go

1 directory, 3 files
</pre><div class="srcfile"><pre><code><span class=line><i>  1</i> <span class="comment">// Command rebel generates rebelious statement.</span></span>
<span class=line><i>  2</i> package main</span>
<span class=line><i>  3</i> </span>
<span class=line><i>  4</i> <span class="keyword">import</span> (</span>
<span class=line><i>  5</i>     "os"</span>
<span class=line><i>  6</i> </span>
<span class=line><i>  7</i>     "github.com/preferit/rebel/phrase"</span>
<span class=line><i>  8</i> )</span>
<span class=line><i>  9</i> </span>
<span class=line><i> 10</i> <span class="keyword">func</span> main() {</span>
<span class=line><i> 11</i>     phrase.Shout(<span class="type">os.Stdout</span>)</span>
<span class=line><i> 12</i> }</span>
<span class=line><i> 13</i> </span></code></pre></div>
</td><td><div class="srcfile"><pre><code><span class=line><i>  1</i> <span class="keyword">package</span> phrase</span>
<span class=line><i>  2</i> </span>
<span class=line><i>  3</i> <span class="keyword">import</span> (</span>
<span class=line><i>  4</i>     "fmt"</span>
<span class=line><i>  5</i>     "io"</span>
<span class=line><i>  6</i>     "math/rand"</span>
<span class=line><i>  7</i> )</span>
<span class=line><i>  8</i> </span>
<span class=line><i>  9</i> <span class="comment">// Shout writes a statement to <span class="type">os.Stdout</span></span></span>
<span class=line><i> 10</i> <span class="keyword">func</span> Shout(w <span class="type">io.Writer</span>) {</span>
<span class=line><i> 11</i>     fmt.Fprintln(w, RandValue(phrases))</span>
<span class=line><i> 12</i> }</span>
<span class=line><i> 13</i> </span>
<span class=line><i> 14</i> <span class="comment">// RandValue returns a random element of the given slice or the zero value.</span></span>
<span class=line><i> 15</i> <span class="keyword">func</span> RandValue[T any](slice []T) (v T) {</span>
<span class=line><i> 16</i>     <span class="keyword">if</span> len(slice) == 0 {</span>
<span class=line><i> 17</i>         <span class="keyword">return</span></span>
<span class=line><i> 18</i>     }</span>
<span class=line><i> 19</i>     i := rand.Intn(len(slice))</span>
<span class=line><i> 20</i>     <span class="keyword">return</span> slice[i]</span>
<span class=line><i> 21</i> }</span>
<span class=line><i> 22</i> </span>
<span class=line><i> 23</i> <span class="keyword">var</span> phrases = []string{</span>
<span class=line><i> 24</i>     "We are Rebelz!",</span>
<span class=line><i> 25</i>     "You may take our lives, but you will never take our freeeedooooom!",</span>
<span class=line><i> 26</i>     "We ain't gonna take it, No!, we ain't gonna take it!",</span>
<span class=line><i> 27</i> }</span>
<span class=line><i> 28</i> </span></code></pre></div>
</td></tr>
</table>
</div>
<nav><ul>
<li><a href="#1">1</a></li>
<li><a href="#2">2</a></li>
<li><a href="#3">3</a></li>
<li><a href="#4">4</a></li>
<li><a href="#5">5</a></li>
<li class="current"><a href="#6">6</a></li>
<li><a href="#7">7</a></li>
<li><a href="#8">8</a></li>
<li><a href="#9">9</a></li>
<li><a href="#10">10</a></li>
<li><a href="#11">11</a></li>
<li> | </li>
<li><a href="#12">12</a></li>
<li><a href="#13">13</a></li>
<li><a href="#14">14</a></li>
<li><a href="#15">15</a></li>
<li><a href="#16">16</a></li>
<li><a href="#17">17</a></li>
<li> | </li>
<li><a href="#18">18</a></li>
<li><a href="#19">19</a></li>
<li><a href="#20">20</a></li>
<li><a href="#21">21</a></li>
<li> | </li>
<li><a href="#22">22</a></li>
<li><a href="#23">23</a></li>
</ul>
</nav>
</div>
<div class="slide" id="7"><header><h2>Improve first redesign</h2>
</header>
<div class="content"><p>We now have multiple stakeholders depending on it and going
        forward they might get affected. Our goal is to be able to
        make changes as freely as possible without affecting the
        stakeholders. Before we release these changes can we improve
        the design?</p>
<table>
<tr><td><pre class="shell dark">$ tree rebel<br/>rebel
├── go.mod
├── main.go
└── phrase
    ├── phrase.go
    └── phrase_test.go

1 directory, 4 files
</pre><div class="srcfile"><pre><code><span class=line><i>  1</i> <span class="comment">// Command rebel generates rebelious statement.</span></span>
<span class=line><i>  2</i> package main</span>
<span class=line><i>  3</i> </span>
<span class=line><i>  4</i> <span class="keyword">import</span> (</span>
<span class=line><i>  5</i>     "fmt"</span>
<span class=line><i>  6</i>     "os"</span>
<span class=line><i>  7</i> </span>
<span class=line><i>  8</i>     "github.com/preferit/rebel/phrase"</span>
<span class=line><i>  9</i> )</span>
<span class=line><i> 10</i> </span>
<span class=line><i> 11</i> <span class="keyword">func</span> main() {</span>
<span class=line><i> 12</i>     phrase.Shout(<span class="type">os.Stdout</span>)</span>
<span class=line><i> 13</i>     fmt.Println()</span>
<span class=line><i> 14</i> }</span>
<span class=line><i> 15</i> </span></code></pre></div>
</td><td><div class="srcfile"><pre><code><span class=line><i>  1</i> <span class="keyword">package</span> phrase</span>
<span class=line><i>  2</i> </span>
<span class=line><i>  3</i> <span class="keyword">import</span> (</span>
<span class=line><i>  4</i>     "fmt"</span>
<span class=line><i>  5</i>     "io"</span>
<span class=line><i>  6</i>     "math/rand"</span>
<span class=line><i>  7</i> )</span>
<span class=line><i>  8</i> </span>
<span class=line><i>  9</i> <span class="comment">// Shout writes a statement to <span class="type">os.Stdout</span></span></span>
<span class=line><i> 10</i> <span class="keyword">func</span> Shout(w <span class="type">io.Writer</span>) {</span>
<span class=line><i> 11</i>     fmt.Fprint(w, randValue(phrases))</span>
<span class=line><i> 12</i> }</span>
<span class=line><i> 13</i> </span>
<span class=line><i> 14</i> <span class="comment">// randValue returns a random element of the given slice or the zero value.</span></span>
<span class=line><i> 15</i> <span class="keyword">func</span> randValue[T any](slice []T) (v T) {</span>
<span class=line><i> 16</i>     <span class="keyword">if</span> len(slice) == 0 {</span>
<span class=line><i> 17</i>         <span class="keyword">return</span></span>
<span class=line><i> 18</i>     }</span>
<span class=line><i> 19</i>     i := rand.Intn(len(slice))</span>
<span class=line><i> 20</i>     <span class="keyword">return</span> slice[i]</span>
<span class=line><i> 21</i> }</span>
<span class=line><i> 22</i> </span>
<span class=line><i> 23</i> <span class="keyword">var</span> phrases = []string{</span>
<span class=line><i> 24</i>     "We are Rebelz!",</span>
<span class=line><i> 25</i>     "You may take our lives, but you will never take our freeeedooooom!",</span>
<span class=line><i> 26</i>     "We ain't gonna take it, No!, we ain't gonna take it!",</span>
<span class=line><i> 27</i> }</span>
<span class=line><i> 28</i> </span></code></pre></div>
</td></tr>
</table>
</div>
<nav><ul>
<li><a href="#1">1</a></li>
<li><a href="#2">2</a></li>
<li><a href="#3">3</a></li>
<li><a href="#4">4</a></li>
<li><a href="#5">5</a></li>
<li><a href="#6">6</a></li>
<li class="current"><a href="#7">7</a></li>
<li><a href="#8">8</a></li>
<li><a href="#9">9</a></li>
<li><a href="#10">10</a></li>
<li><a href="#11">11</a></li>
<li> | </li>
<li><a href="#12">12</a></li>
<li><a href="#13">13</a></li>
<li><a href="#14">14</a></li>
<li><a href="#15">15</a></li>
<li><a href="#16">16</a></li>
<li><a href="#17">17</a></li>
<li> | </li>
<li><a href="#18">18</a></li>
<li><a href="#19">19</a></li>
<li><a href="#20">20</a></li>
<li><a href="#21">21</a></li>
<li> | </li>
<li><a href="#22">22</a></li>
<li><a href="#23">23</a></li>
</ul>
</nav>
</div>
<div class="slide" id="8"><header><h2>Fix the repetition when used as a command</h2>
</header>
<div class="content"><table>
<tr><td><pre class="shell dark">$ tree rebel<br/>rebel
├── go.mod
├── main.go
└── phrase
    ├── phrase.go
    └── phrase_test.go

1 directory, 4 files
</pre><div class="srcfile"><pre><code><span class=line><i>  1</i> <span class="comment">// Command rebel generates rebelious statement.</span></span>
<span class=line><i>  2</i> package main</span>
<span class=line><i>  3</i> </span>
<span class=line><i>  4</i> <span class="keyword">import</span> (</span>
<span class=line><i>  5</i>     "bytes"</span>
<span class=line><i>  6</i>     "fmt"</span>
<span class=line><i>  7</i>     "os"</span>
<span class=line><i>  8</i> </span>
<span class=line><i>  9</i>     "github.com/preferit/rebel/phrase"</span>
<span class=line><i> 10</i> )</span>
<span class=line><i> 11</i> </span>
<span class=line><i> 12</i> <span class="keyword">func</span> main() {</span>
<span class=line><i> 13</i>     <span class="comment">// cache of last statement</span></span>
<span class=line><i> 14</i>     cache := "/tmp/lastphrase"</span>
<span class=line><i> 15</i>     last, _ := os.ReadFile(cache)</span>
<span class=line><i> 16</i>     <span class="comment">// ignore error, we don't care</span></span>
<span class=line><i> 17</i>     <span class="keyword">var</span> buf <span class="type">bytes.Buffer</span></span>
<span class=line><i> 18</i>     <span class="keyword">for</span> {</span>
<span class=line><i> 19</i>         buf.Reset()</span>
<span class=line><i> 20</i>         phrase.Shout(&buf)</span>
<span class=line><i> 21</i>         <span class="keyword">if</span> bytes.Equal(last, buf.Bytes()) {</span>
<span class=line><i> 22</i>             continue</span>
<span class=line><i> 23</i>         }</span>
<span class=line><i> 24</i>         break</span>
<span class=line><i> 25</i>     }</span>
<span class=line><i> 26</i>     <span class="comment">// save</span></span>
<span class=line><i> 27</i>     _ = os.WriteFile(cache, buf.Bytes(), 0644)</span>
<span class=line><i> 28</i>     fmt.Println(buf.String())</span>
<span class=line><i> 29</i> }</span>
<span class=line><i> 30</i> </span></code></pre></div>
</td><td><p>What are the implications of our current design?</p>
<ul>
<li>Lisa can import it with <code>import github.com/preferit/rebel/phrase</code></li>
<li>Max can install it simply with <code>go install github.com/preferit/rebel@latest</code></li>
</ul>
<p>It feels ok, current needs are met. You and Max quickly
        notice that the same phrase appears over and over and add a
        the feature of keeping last shouted phrase in a temporary file
        to minimize the repetition when you run your commands.</p>
<div class="srcfile"><pre><code><span class=line><i>  1</i> <span class="keyword">package</span> phrase</span>
<span class=line><i>  2</i> </span>
<span class=line><i>  3</i> <span class="keyword">import</span> (</span>
<span class=line><i>  4</i>     "fmt"</span>
<span class=line><i>  5</i>     "io"</span>
<span class=line><i>  6</i>     "math/rand"</span>
<span class=line><i>  7</i> )</span>
<span class=line><i>  8</i> </span>
<span class=line><i>  9</i> <span class="comment">// Shout writes a statement to <span class="type">os.Stdout</span></span></span>
<span class=line><i> 10</i> <span class="keyword">func</span> Shout(w <span class="type">io.Writer</span>) {</span>
<span class=line><i> 11</i>     fmt.Fprint(w, randValue(phrases))</span>
<span class=line><i> 12</i> }</span>
<span class=line><i> 13</i> </span>
<span class=line><i> 14</i> <span class="comment">// randValue returns a random element of the given slice or the zero value.</span></span>
<span class=line><i> 15</i> <span class="keyword">func</span> randValue[T any](slice []T) (v T) {</span>
<span class=line><i> 16</i>     <span class="keyword">if</span> len(slice) == 0 {</span>
<span class=line><i> 17</i>         <span class="keyword">return</span></span>
<span class=line><i> 18</i>     }</span>
<span class=line><i> 19</i>     i := rand.Intn(len(slice))</span>
<span class=line><i> 20</i>     <span class="keyword">return</span> slice[i]</span>
<span class=line><i> 21</i> }</span>
<span class=line><i> 22</i> </span>
<span class=line><i> 23</i> <span class="keyword">var</span> phrases = []string{</span>
<span class=line><i> 24</i>     "We are Rebelz!",</span>
<span class=line><i> 25</i>     "You may take our lives, but you will never take our freeeedooooom!",</span>
<span class=line><i> 26</i>     "We ain't gonna take it, No!, we ain't gonna take it!",</span>
<span class=line><i> 27</i> }</span>
<span class=line><i> 28</i> </span></code></pre></div>
</td></tr>
</table>
</div>
<nav><ul>
<li><a href="#1">1</a></li>
<li><a href="#2">2</a></li>
<li><a href="#3">3</a></li>
<li><a href="#4">4</a></li>
<li><a href="#5">5</a></li>
<li><a href="#6">6</a></li>
<li><a href="#7">7</a></li>
<li class="current"><a href="#8">8</a></li>
<li><a href="#9">9</a></li>
<li><a href="#10">10</a></li>
<li><a href="#11">11</a></li>
<li> | </li>
<li><a href="#12">12</a></li>
<li><a href="#13">13</a></li>
<li><a href="#14">14</a></li>
<li><a href="#15">15</a></li>
<li><a href="#16">16</a></li>
<li><a href="#17">17</a></li>
<li> | </li>
<li><a href="#18">18</a></li>
<li><a href="#19">19</a></li>
<li><a href="#20">20</a></li>
<li><a href="#21">21</a></li>
<li> | </li>
<li><a href="#22">22</a></li>
<li><a href="#23">23</a></li>
</ul>
</nav>
</div>
<div class="slide" id="9"><header><h2>The first deadend</h2>
</header>
<div class="content"><p>Some time passes and Lisas swings by your office asking if
        you could implement something that doesn't repeat the same
        phrase every day?  But you just did, how do you now share it
        with Lisa?  At this point you'll realize that the initial
        redesign with the added phrase package, may need to changed
        and your own code updated aswell. This is one of those
        deadends where you have to turn around and find another
        path.</p>
<img src="firstdeadend.png"/><p>We can explore ways to use the current design, e.g. put
        some caching mechanism into the phrase package, but that seems
        out of place.  Also the caching for the command invocation
        locally on your computer may differ from what is available on
        the intranet site, you don't know at this point.  If we
        backtrack to the time where Max and Lisa came onboard, could
        we have taken a different route that would avoid this
        scenario?</p>
</div>
<nav><ul>
<li><a href="#1">1</a></li>
<li><a href="#2">2</a></li>
<li><a href="#3">3</a></li>
<li><a href="#4">4</a></li>
<li><a href="#5">5</a></li>
<li><a href="#6">6</a></li>
<li><a href="#7">7</a></li>
<li><a href="#8">8</a></li>
<li class="current"><a href="#9">9</a></li>
<li><a href="#10">10</a></li>
<li><a href="#11">11</a></li>
<li> | </li>
<li><a href="#12">12</a></li>
<li><a href="#13">13</a></li>
<li><a href="#14">14</a></li>
<li><a href="#15">15</a></li>
<li><a href="#16">16</a></li>
<li><a href="#17">17</a></li>
<li> | </li>
<li><a href="#18">18</a></li>
<li><a href="#19">19</a></li>
<li><a href="#20">20</a></li>
<li><a href="#21">21</a></li>
<li> | </li>
<li><a href="#22">22</a></li>
<li><a href="#23">23</a></li>
</ul>
</nav>
</div>
<div class="slide" id="10"><header><h2>What did we do wrong?</h2>
</header>
<div class="content"><p>Let's go through our reasoning and see if we can find the
        culprit before trying to solve it. Lisa and Max where not very
        specific about their needs just that they wanted to show a
        random phrase in different ways, in the terminal and on a
        webpage. We choose to extract the phrase generating logic for
        Lisa to use and told Max to use the command. Then we added
        more logic in the command, because it was You and Max that saw
        the problem. What Lisa wants now is the logic that is found in
        the command, but her current dependency is elsewhere.</p>
<p>Looking at the code more closely we placed func Shout
        inside the phrase package, why? <em>phrases don't shout, rebels
        do</em>. So if we want to keep func Shout in the package rebel And
        we want to share it with Lisa, how do we solve that?</p>
<table>
<tr><td><pre class="shell dark">$ tree rebel<br/>rebel
├── go.mod
├── main.go
└── phrase
    ├── phrase.go
    └── phrase_test.go

1 directory, 4 files
</pre><div class="srcfile"><pre><code><span class=line><i>  1</i> <span class="comment">// Command rebel generates rebelious statement.</span></span>
<span class=line><i>  2</i> package main</span>
<span class=line><i>  3</i> </span>
<span class=line><i>  4</i> <span class="keyword">import</span> (</span>
<span class=line><i>  5</i>     "fmt"</span>
<span class=line><i>  6</i>     "os"</span>
<span class=line><i>  7</i> </span>
<span class=line><i>  8</i>     "github.com/preferit/rebel/phrase"</span>
<span class=line><i>  9</i> )</span>
<span class=line><i> 10</i> </span>
<span class=line><i> 11</i> <span class="keyword">func</span> main() {</span>
<span class=line><i> 12</i>     phrase.Shout(<span class="type">os.Stdout</span>)</span>
<span class=line><i> 13</i>     fmt.Println()</span>
<span class=line><i> 14</i> }</span>
<span class=line><i> 15</i> </span></code></pre></div>
</td><td><div class="srcfile"><pre><code><span class=line><i>  1</i> <span class="keyword">package</span> phrase</span>
<span class=line><i>  2</i> </span>
<span class=line><i>  3</i> <span class="keyword">import</span> (</span>
<span class=line><i>  4</i>     "fmt"</span>
<span class=line><i>  5</i>     "io"</span>
<span class=line><i>  6</i>     "math/rand"</span>
<span class=line><i>  7</i> )</span>
<span class=line><i>  8</i> </span>
<span class=line><i>  9</i> <span class="comment">// Shout writes a statement to <span class="type">os.Stdout</span></span></span>
<span class=line><i> 10</i> <span class="keyword">func</span> Shout(w <span class="type">io.Writer</span>) {</span>
<span class=line><i> 11</i>     fmt.Fprint(w, randValue(phrases))</span>
<span class=line><i> 12</i> }</span>
<span class=line><i> 13</i> </span>
<span class=line><i> 14</i> <span class="comment">// randValue returns a random element of the given slice or the zero value.</span></span>
<span class=line><i> 15</i> <span class="keyword">func</span> randValue[T any](slice []T) (v T) {</span>
<span class=line><i> 16</i>     <span class="keyword">if</span> len(slice) == 0 {</span>
<span class=line><i> 17</i>         <span class="keyword">return</span></span>
<span class=line><i> 18</i>     }</span>
<span class=line><i> 19</i>     i := rand.Intn(len(slice))</span>
<span class=line><i> 20</i>     <span class="keyword">return</span> slice[i]</span>
<span class=line><i> 21</i> }</span>
<span class=line><i> 22</i> </span>
<span class=line><i> 23</i> <span class="keyword">var</span> phrases = []string{</span>
<span class=line><i> 24</i>     "We are Rebelz!",</span>
<span class=line><i> 25</i>     "You may take our lives, but you will never take our freeeedooooom!",</span>
<span class=line><i> 26</i>     "We ain't gonna take it, No!, we ain't gonna take it!",</span>
<span class=line><i> 27</i> }</span>
<span class=line><i> 28</i> </span></code></pre></div>
</td></tr>
</table>
<b>Move command, keep domain logic.</b></div>
<nav><ul>
<li><a href="#1">1</a></li>
<li><a href="#2">2</a></li>
<li><a href="#3">3</a></li>
<li><a href="#4">4</a></li>
<li><a href="#5">5</a></li>
<li><a href="#6">6</a></li>
<li><a href="#7">7</a></li>
<li><a href="#8">8</a></li>
<li><a href="#9">9</a></li>
<li class="current"><a href="#10">10</a></li>
<li><a href="#11">11</a></li>
<li> | </li>
<li><a href="#12">12</a></li>
<li><a href="#13">13</a></li>
<li><a href="#14">14</a></li>
<li><a href="#15">15</a></li>
<li><a href="#16">16</a></li>
<li><a href="#17">17</a></li>
<li> | </li>
<li><a href="#18">18</a></li>
<li><a href="#19">19</a></li>
<li><a href="#20">20</a></li>
<li><a href="#21">21</a></li>
<li> | </li>
<li><a href="#22">22</a></li>
<li><a href="#23">23</a></li>
</ul>
</nav>
</div>
<div class="slide" id="11"><header><h2>Move command, keep domain logic</h2>
</header>
<div class="content"><table>
<tr><td><pre class="shell dark">$ tree rebel<br/>rebel
├── cmd
│   └── rebel
│       └── main.go
├── go.mod
├── phrase.go
├── rebel.go
└── rebel_test.go

2 directories, 5 files
</pre><div class="srcfile"><pre><code><span class=line><i>  1</i> <span class="comment">// Command rebel generates rebelious statement.</span></span>
<span class=line><i>  2</i> package main</span>
<span class=line><i>  3</i> </span>
<span class=line><i>  4</i> <span class="keyword">import</span> (</span>
<span class=line><i>  5</i>     "fmt"</span>
<span class=line><i>  6</i>     "os"</span>
<span class=line><i>  7</i> </span>
<span class=line><i>  8</i>     "github.com/preferit/rebel"</span>
<span class=line><i>  9</i> )</span>
<span class=line><i> 10</i> </span>
<span class=line><i> 11</i> <span class="keyword">func</span> main() {</span>
<span class=line><i> 12</i>     rebel.MinimizeRepetition = true</span>
<span class=line><i> 13</i>     rebel.Shout(<span class="type">os.Stdout</span>)</span>
<span class=line><i> 14</i>     fmt.Println()</span>
<span class=line><i> 15</i> }</span>
<span class=line><i> 16</i> </span></code></pre></div>
</td><td><div class="srcfile"><pre><code><span class=line><i>  1</i> <span class="keyword">package</span> rebel</span>
<span class=line><i>  2</i> </span>
<span class=line><i>  3</i> <span class="keyword">import</span> (</span>
<span class=line><i>  4</i>     "io"</span>
<span class=line><i>  5</i>     "os"</span>
<span class=line><i>  6</i> )</span>
<span class=line><i>  7</i> </span>
<span class=line><i>  8</i> <span class="comment">// Shout writes a statement to os.Stdout. Affected by</span></span>
<span class=line><i>  9</i> <span class="comment">// MinimizeRepetition flag.</span></span>
<span class=line><i> 10</i> <span class="keyword">func</span> Shout(w <span class="type">io.Writer</span>) {</span>
<span class=line><i> 11</i>     next := randValue(phrases)</span>
<span class=line><i> 12</i> </span>
<span class=line><i> 13</i>     <span class="keyword">if</span> MinimizeRepetition {</span>
<span class=line><i> 14</i>         cache := "/tmp/lastphrase"</span>
<span class=line><i> 15</i>         last, _ := os.ReadFile(cache)</span>
<span class=line><i> 16</i>         <span class="keyword">for</span> {</span>
<span class=line><i> 17</i>             <span class="keyword">if</span> string(last) == next {</span>
<span class=line><i> 18</i>                 next = randValue(phrases)</span>
<span class=line><i> 19</i>                 continue</span>
<span class=line><i> 20</i>             }</span>
<span class=line><i> 21</i>             break</span>
<span class=line><i> 22</i>         }</span>
<span class=line><i> 23</i>         _ = os.WriteFile(cache, []byte(next), 0644)</span>
<span class=line><i> 24</i>     }</span>
<span class=line><i> 25</i>     w.Write([]byte(next))</span>
<span class=line><i> 26</i> }</span>
<span class=line><i> 27</i> </span>
<span class=line><i> 28</i> <span class="keyword">var</span> MinimizeRepetition bool</span>
<span class=line><i> 29</i> </span></code></pre></div>
</td></tr>
</table>
<p>This design, is as effortless as the first attempt at the
        decision point, but it makes it easier to evolve the rebel
        logic. It also forces you to design rebel features in such a
        way that they may be used by Lisa as well as Max.</p>
</div>
<nav><ul>
<li><a href="#1">1</a></li>
<li><a href="#2">2</a></li>
<li><a href="#3">3</a></li>
<li><a href="#4">4</a></li>
<li><a href="#5">5</a></li>
<li><a href="#6">6</a></li>
<li><a href="#7">7</a></li>
<li><a href="#8">8</a></li>
<li><a href="#9">9</a></li>
<li><a href="#10">10</a></li>
<li class="current"><a href="#11">11</a></li>
<li> | </li>
<li><a href="#12">12</a></li>
<li><a href="#13">13</a></li>
<li><a href="#14">14</a></li>
<li><a href="#15">15</a></li>
<li><a href="#16">16</a></li>
<li><a href="#17">17</a></li>
<li> | </li>
<li><a href="#18">18</a></li>
<li><a href="#19">19</a></li>
<li><a href="#20">20</a></li>
<li><a href="#21">21</a></li>
<li> | </li>
<li><a href="#22">22</a></li>
<li><a href="#23">23</a></li>
</ul>
</nav>
</div>
<div class="slide" id="12"><header><h2>Lisa wants a service</h2>
</header>
<div class="content"><p>The project will grow and at some point Lisa comes by and
        says they are switching languages for the intranet
        implementation but they really want to have access to the
        logic of generating rebelious statements. Could you write a
        service that exposes it?<br> Easy peasy, but where to put it?
        we a few choices</p>
<table class="columns">
<tr><td><h3>1</h3>
Add the service logic in existing command</td><td><h3>2</h3>
Add the service logic in package rebel</td><td><h3>3</h3>
Add the service logic in package rebel/service</td><td><h3>4</h3>
New command only</td><td><h3>5</h3>
Combine option 3 and 4</td></tr>
</table>
</div>
<nav><ul>
<li><a href="#1">1</a></li>
<li><a href="#2">2</a></li>
<li><a href="#3">3</a></li>
<li><a href="#4">4</a></li>
<li><a href="#5">5</a></li>
<li><a href="#6">6</a></li>
<li><a href="#7">7</a></li>
<li><a href="#8">8</a></li>
<li><a href="#9">9</a></li>
<li><a href="#10">10</a></li>
<li><a href="#11">11</a></li>
<li> | </li>
<li class="current"><a href="#12">12</a></li>
<li><a href="#13">13</a></li>
<li><a href="#14">14</a></li>
<li><a href="#15">15</a></li>
<li><a href="#16">16</a></li>
<li><a href="#17">17</a></li>
<li> | </li>
<li><a href="#18">18</a></li>
<li><a href="#19">19</a></li>
<li><a href="#20">20</a></li>
<li><a href="#21">21</a></li>
<li> | </li>
<li><a href="#22">22</a></li>
<li><a href="#23">23</a></li>
</ul>
</nav>
</div>
<div class="slide" id="13"><header><h2>Lisa wants a service</h2>
</header>
<div class="content"><p>The project will grow and at some point Lisa comes by and
        says they are switching languages for the intranet
        implementation but they really want to have access to the
        logic of generating rebelious statements. Could you write a
        service that exposes it?<br> Easy peasy, but where to put it?
        we a few choices</p>
<table class="columns">
<tr><td><h3>1</h3>
Add the service logic in existing command<pre class="shell dark">$ tree rebel<br/>rebel
├── cmd
│   └── rebel
│       ├── main.go
│       └── service.go
├── go.mod
├── phrase.go
├── rebel.go
└── rebel_test.go

2 directories, 6 files
</pre><h3>Pros</h3>
<ul>
<li>Package rebel remains untouched</li>
<li>API logic separated from domain logic</li>
</ul>
<h3>Cons</h3>
<ul>
<li>Existing command increases in complexity that Max does not need</li>
<li>API logic mixed with command logic</li>
</ul>
</td><td><h3>2</h3>
Add the service logic in package rebel</td><td><h3>3</h3>
Add the service logic in package rebel/service</td><td><h3>4</h3>
New command only</td><td><h3>5</h3>
Combine option 3 and 4</td></tr>
</table>
</div>
<nav><ul>
<li><a href="#1">1</a></li>
<li><a href="#2">2</a></li>
<li><a href="#3">3</a></li>
<li><a href="#4">4</a></li>
<li><a href="#5">5</a></li>
<li><a href="#6">6</a></li>
<li><a href="#7">7</a></li>
<li><a href="#8">8</a></li>
<li><a href="#9">9</a></li>
<li><a href="#10">10</a></li>
<li><a href="#11">11</a></li>
<li> | </li>
<li><a href="#12">12</a></li>
<li class="current"><a href="#13">13</a></li>
<li><a href="#14">14</a></li>
<li><a href="#15">15</a></li>
<li><a href="#16">16</a></li>
<li><a href="#17">17</a></li>
<li> | </li>
<li><a href="#18">18</a></li>
<li><a href="#19">19</a></li>
<li><a href="#20">20</a></li>
<li><a href="#21">21</a></li>
<li> | </li>
<li><a href="#22">22</a></li>
<li><a href="#23">23</a></li>
</ul>
</nav>
</div>
<div class="slide" id="14"><header><h2>Lisa wants a service</h2>
</header>
<div class="content"><p>The project will grow and at some point Lisa comes by and
        says they are switching languages for the intranet
        implementation but they really want to have access to the
        logic of generating rebelious statements. Could you write a
        service that exposes it?<br> Easy peasy, but where to put it?
        we a few choices</p>
<table class="columns">
<tr><td><h3>1</h3>
Add the service logic in existing command<pre class="shell dark">$ tree rebel<br/>rebel
├── cmd
│   └── rebel
│       ├── main.go
│       └── service.go
├── go.mod
├── phrase.go
├── rebel.go
└── rebel_test.go

2 directories, 6 files
</pre><h3>Pros</h3>
<ul>
<li>Package rebel remains untouched</li>
<li>API logic separated from domain logic</li>
</ul>
<h3>Cons</h3>
<ul>
<li>Existing command increases in complexity that Max does not need</li>
<li>API logic mixed with command logic</li>
</ul>
</td><td><h3>2</h3>
Add the service logic in package rebel<pre class="shell dark">$ tree rebel<br/>rebel
├── cmd
│   └── rebel
│       └── main.go
├── go.mod
├── phrase.go
├── rebel.go
├── rebel_test.go
└── service.go

2 directories, 6 files
</pre><h3>Pros</h3>
<ul>
<li>I can't see any</li>
</ul>
<h3>Cons</h3>
<ul>
<li>Existing command increases in complexity that Max does not need</li>
<li>API logic mixed with domain logic</li>
</ul>
</td><td><h3>3</h3>
Add the service logic in package rebel/service</td><td><h3>4</h3>
New command only</td><td><h3>5</h3>
Combine option 3 and 4</td></tr>
</table>
</div>
<nav><ul>
<li><a href="#1">1</a></li>
<li><a href="#2">2</a></li>
<li><a href="#3">3</a></li>
<li><a href="#4">4</a></li>
<li><a href="#5">5</a></li>
<li><a href="#6">6</a></li>
<li><a href="#7">7</a></li>
<li><a href="#8">8</a></li>
<li><a href="#9">9</a></li>
<li><a href="#10">10</a></li>
<li><a href="#11">11</a></li>
<li> | </li>
<li><a href="#12">12</a></li>
<li><a href="#13">13</a></li>
<li class="current"><a href="#14">14</a></li>
<li><a href="#15">15</a></li>
<li><a href="#16">16</a></li>
<li><a href="#17">17</a></li>
<li> | </li>
<li><a href="#18">18</a></li>
<li><a href="#19">19</a></li>
<li><a href="#20">20</a></li>
<li><a href="#21">21</a></li>
<li> | </li>
<li><a href="#22">22</a></li>
<li><a href="#23">23</a></li>
</ul>
</nav>
</div>
<div class="slide" id="15"><header><h2>Lisa wants a service</h2>
</header>
<div class="content"><p>The project will grow and at some point Lisa comes by and
        says they are switching languages for the intranet
        implementation but they really want to have access to the
        logic of generating rebelious statements. Could you write a
        service that exposes it?<br> Easy peasy, but where to put it?
        we a few choices</p>
<table class="columns">
<tr><td><h3>1</h3>
Add the service logic in existing command<pre class="shell dark">$ tree rebel<br/>rebel
├── cmd
│   └── rebel
│       ├── main.go
│       └── service.go
├── go.mod
├── phrase.go
├── rebel.go
└── rebel_test.go

2 directories, 6 files
</pre><h3>Pros</h3>
<ul>
<li>Package rebel remains untouched</li>
<li>API logic separated from domain logic</li>
</ul>
<h3>Cons</h3>
<ul>
<li>Existing command increases in complexity that Max does not need</li>
<li>API logic mixed with command logic</li>
</ul>
</td><td><h3>2</h3>
Add the service logic in package rebel<pre class="shell dark">$ tree rebel<br/>rebel
├── cmd
│   └── rebel
│       └── main.go
├── go.mod
├── phrase.go
├── rebel.go
├── rebel_test.go
└── service.go

2 directories, 6 files
</pre><h3>Pros</h3>
<ul>
<li>I can't see any</li>
</ul>
<h3>Cons</h3>
<ul>
<li>Existing command increases in complexity that Max does not need</li>
<li>API logic mixed with domain logic</li>
</ul>
</td><td><h3>3</h3>
Add the service logic in package rebel/service<pre class="shell dark">$ tree rebel<br/>rebel
├── cmd
│   └── rebel
│       └── main.go
├── go.mod
├── phrase.go
├── rebel.go
├── rebel_test.go
└── service
    └── service.go

3 directories, 6 files
</pre><h3>Pros</h3>
<ul>
<li>Package rebel remains untouched</li>
<li>API logic separated from domain logic</li>
</ul>
<h3>Cons</h3>
<ul>
<li>Existing command increases in complexity that Max does not need</li>
</ul>
</td><td><h3>4</h3>
New command only</td><td><h3>5</h3>
Combine option 3 and 4</td></tr>
</table>
</div>
<nav><ul>
<li><a href="#1">1</a></li>
<li><a href="#2">2</a></li>
<li><a href="#3">3</a></li>
<li><a href="#4">4</a></li>
<li><a href="#5">5</a></li>
<li><a href="#6">6</a></li>
<li><a href="#7">7</a></li>
<li><a href="#8">8</a></li>
<li><a href="#9">9</a></li>
<li><a href="#10">10</a></li>
<li><a href="#11">11</a></li>
<li> | </li>
<li><a href="#12">12</a></li>
<li><a href="#13">13</a></li>
<li><a href="#14">14</a></li>
<li class="current"><a href="#15">15</a></li>
<li><a href="#16">16</a></li>
<li><a href="#17">17</a></li>
<li> | </li>
<li><a href="#18">18</a></li>
<li><a href="#19">19</a></li>
<li><a href="#20">20</a></li>
<li><a href="#21">21</a></li>
<li> | </li>
<li><a href="#22">22</a></li>
<li><a href="#23">23</a></li>
</ul>
</nav>
</div>
<div class="slide" id="16"><header><h2>Lisa wants a service</h2>
</header>
<div class="content"><p>The project will grow and at some point Lisa comes by and
        says they are switching languages for the intranet
        implementation but they really want to have access to the
        logic of generating rebelious statements. Could you write a
        service that exposes it?<br> Easy peasy, but where to put it?
        we a few choices</p>
<table class="columns">
<tr><td><h3>1</h3>
Add the service logic in existing command<pre class="shell dark">$ tree rebel<br/>rebel
├── cmd
│   └── rebel
│       ├── main.go
│       └── service.go
├── go.mod
├── phrase.go
├── rebel.go
└── rebel_test.go

2 directories, 6 files
</pre><h3>Pros</h3>
<ul>
<li>Package rebel remains untouched</li>
<li>API logic separated from domain logic</li>
</ul>
<h3>Cons</h3>
<ul>
<li>Existing command increases in complexity that Max does not need</li>
<li>API logic mixed with command logic</li>
</ul>
</td><td><h3>2</h3>
Add the service logic in package rebel<pre class="shell dark">$ tree rebel<br/>rebel
├── cmd
│   └── rebel
│       └── main.go
├── go.mod
├── phrase.go
├── rebel.go
├── rebel_test.go
└── service.go

2 directories, 6 files
</pre><h3>Pros</h3>
<ul>
<li>I can't see any</li>
</ul>
<h3>Cons</h3>
<ul>
<li>Existing command increases in complexity that Max does not need</li>
<li>API logic mixed with domain logic</li>
</ul>
</td><td><h3>3</h3>
Add the service logic in package rebel/service<pre class="shell dark">$ tree rebel<br/>rebel
├── cmd
│   └── rebel
│       └── main.go
├── go.mod
├── phrase.go
├── rebel.go
├── rebel_test.go
└── service
    └── service.go

3 directories, 6 files
</pre><h3>Pros</h3>
<ul>
<li>Package rebel remains untouched</li>
<li>API logic separated from domain logic</li>
</ul>
<h3>Cons</h3>
<ul>
<li>Existing command increases in complexity that Max does not need</li>
</ul>
</td><td><h3>4</h3>
New command only<pre class="shell dark">$ tree rebel<br/>rebel
├── cmd
│   ├── rebel
│   │   └── main.go
│   └── rebelsrv
│       ├── main.go
│       └── service.go
├── go.mod
├── phrase.go
├── rebel.go
└── rebel_test.go

3 directories, 7 files
</pre><h3>Pros</h3>
<ul>
<li>Package rebel remains untouched</li>
<li>API logic separated from domain logic</li>
<li>Existing command remains intact</li>
</ul>
<h3>Cons</h3>
<ul>
<li>Build complexity increases, each stakeholder has their own command</li>
</ul>
</td><td><h3>5</h3>
Combine option 3 and 4</td></tr>
</table>
</div>
<nav><ul>
<li><a href="#1">1</a></li>
<li><a href="#2">2</a></li>
<li><a href="#3">3</a></li>
<li><a href="#4">4</a></li>
<li><a href="#5">5</a></li>
<li><a href="#6">6</a></li>
<li><a href="#7">7</a></li>
<li><a href="#8">8</a></li>
<li><a href="#9">9</a></li>
<li><a href="#10">10</a></li>
<li><a href="#11">11</a></li>
<li> | </li>
<li><a href="#12">12</a></li>
<li><a href="#13">13</a></li>
<li><a href="#14">14</a></li>
<li><a href="#15">15</a></li>
<li class="current"><a href="#16">16</a></li>
<li><a href="#17">17</a></li>
<li> | </li>
<li><a href="#18">18</a></li>
<li><a href="#19">19</a></li>
<li><a href="#20">20</a></li>
<li><a href="#21">21</a></li>
<li> | </li>
<li><a href="#22">22</a></li>
<li><a href="#23">23</a></li>
</ul>
</nav>
</div>
<div class="slide" id="17"><header><h2>Lisa wants a service</h2>
</header>
<div class="content"><p>The project will grow and at some point Lisa comes by and
        says they are switching languages for the intranet
        implementation but they really want to have access to the
        logic of generating rebelious statements. Could you write a
        service that exposes it?<br> Easy peasy, but where to put it?
        we a few choices</p>
<table class="columns">
<tr><td><h3>1</h3>
Add the service logic in existing command<pre class="shell dark">$ tree rebel<br/>rebel
├── cmd
│   └── rebel
│       ├── main.go
│       └── service.go
├── go.mod
├── phrase.go
├── rebel.go
└── rebel_test.go

2 directories, 6 files
</pre><h3>Pros</h3>
<ul>
<li>Package rebel remains untouched</li>
<li>API logic separated from domain logic</li>
</ul>
<h3>Cons</h3>
<ul>
<li>Existing command increases in complexity that Max does not need</li>
<li>API logic mixed with command logic</li>
</ul>
</td><td><h3>2</h3>
Add the service logic in package rebel<pre class="shell dark">$ tree rebel<br/>rebel
├── cmd
│   └── rebel
│       └── main.go
├── go.mod
├── phrase.go
├── rebel.go
├── rebel_test.go
└── service.go

2 directories, 6 files
</pre><h3>Pros</h3>
<ul>
<li>I can't see any</li>
</ul>
<h3>Cons</h3>
<ul>
<li>Existing command increases in complexity that Max does not need</li>
<li>API logic mixed with domain logic</li>
</ul>
</td><td><h3>3</h3>
Add the service logic in package rebel/service<pre class="shell dark">$ tree rebel<br/>rebel
├── cmd
│   └── rebel
│       └── main.go
├── go.mod
├── phrase.go
├── rebel.go
├── rebel_test.go
└── service
    └── service.go

3 directories, 6 files
</pre><h3>Pros</h3>
<ul>
<li>Package rebel remains untouched</li>
<li>API logic separated from domain logic</li>
</ul>
<h3>Cons</h3>
<ul>
<li>Existing command increases in complexity that Max does not need</li>
</ul>
</td><td><h3>4</h3>
New command only<pre class="shell dark">$ tree rebel<br/>rebel
├── cmd
│   ├── rebel
│   │   └── main.go
│   └── rebelsrv
│       ├── main.go
│       └── service.go
├── go.mod
├── phrase.go
├── rebel.go
└── rebel_test.go

3 directories, 7 files
</pre><h3>Pros</h3>
<ul>
<li>Package rebel remains untouched</li>
<li>API logic separated from domain logic</li>
<li>Existing command remains intact</li>
</ul>
<h3>Cons</h3>
<ul>
<li>Build complexity increases, each stakeholder has their own command</li>
</ul>
</td><td><h3>5</h3>
Combine option 3 and 4<pre class="shell dark">$ tree rebel<br/>rebel
├── cmd
│   ├── rebel
│   │   └── main.go
│   └── rebelsrv
│       └── main.go
├── go.mod
├── phrase.go
├── rebel.go
├── rebel_test.go
└── service
    └── service.go

4 directories, 7 files
</pre></td></tr>
</table>
</div>
<nav><ul>
<li><a href="#1">1</a></li>
<li><a href="#2">2</a></li>
<li><a href="#3">3</a></li>
<li><a href="#4">4</a></li>
<li><a href="#5">5</a></li>
<li><a href="#6">6</a></li>
<li><a href="#7">7</a></li>
<li><a href="#8">8</a></li>
<li><a href="#9">9</a></li>
<li><a href="#10">10</a></li>
<li><a href="#11">11</a></li>
<li> | </li>
<li><a href="#12">12</a></li>
<li><a href="#13">13</a></li>
<li><a href="#14">14</a></li>
<li><a href="#15">15</a></li>
<li><a href="#16">16</a></li>
<li class="current"><a href="#17">17</a></li>
<li> | </li>
<li><a href="#18">18</a></li>
<li><a href="#19">19</a></li>
<li><a href="#20">20</a></li>
<li><a href="#21">21</a></li>
<li> | </li>
<li><a href="#22">22</a></li>
<li><a href="#23">23</a></li>
</ul>
</nav>
</div>
<div class="slide" id="18"><header><h2>The crawl feature</h2>
</header>
<div class="content"><p>The service is up and running and you get an idea of adding
		a feature to package rebel for scanning the web for statements
		that the rebel can shout. It doesn't feel like the feature
		fits in the rebel package directly but will be used by
		it. Let's call the feature crawl, but where to put it?</p>
<table class="columns">
<tr><td><h3>1</h3>
Add it directly in package rebel</td><td><h3>2</h3>
Add it to an internal/crawl package</td><td><h3>3</h3>
Add to a sub package</td></tr>
</table>
</div>
<nav><ul>
<li><a href="#1">1</a></li>
<li><a href="#2">2</a></li>
<li><a href="#3">3</a></li>
<li><a href="#4">4</a></li>
<li><a href="#5">5</a></li>
<li><a href="#6">6</a></li>
<li><a href="#7">7</a></li>
<li><a href="#8">8</a></li>
<li><a href="#9">9</a></li>
<li><a href="#10">10</a></li>
<li><a href="#11">11</a></li>
<li> | </li>
<li><a href="#12">12</a></li>
<li><a href="#13">13</a></li>
<li><a href="#14">14</a></li>
<li><a href="#15">15</a></li>
<li><a href="#16">16</a></li>
<li><a href="#17">17</a></li>
<li> | </li>
<li class="current"><a href="#18">18</a></li>
<li><a href="#19">19</a></li>
<li><a href="#20">20</a></li>
<li><a href="#21">21</a></li>
<li> | </li>
<li><a href="#22">22</a></li>
<li><a href="#23">23</a></li>
</ul>
</nav>
</div>
<div class="slide" id="19"><header><h2>The crawl feature</h2>
</header>
<div class="content"><p>The service is up and running and you get an idea of adding
		a feature to package rebel for scanning the web for statements
		that the rebel can shout. It doesn't feel like the feature
		fits in the rebel package directly but will be used by
		it. Let's call the feature crawl, but where to put it?</p>
<table class="columns">
<tr><td><h3>1</h3>
Add it directly in package rebel<pre class="shell dark">$ tree rebel<br/>rebel
├── cmd
│   ├── rebel
│   │   └── main.go
│   └── rebelsrv
│       └── main.go
├── crawl.go
├── go.mod
├── phrase.go
├── rebel.go
├── rebel_test.go
└── service
    └── service.go

4 directories, 8 files
</pre><h4>Pros</h4>
<ul>
<li><em>Easy to edit initially</em></li>
</ul>
<h4>Cons</h4>
<ul>
<li>Tightly coupled with the rebel domain logic</li>
</ul>
</td><td><h3>2</h3>
Add it to an internal/crawl package</td><td><h3>3</h3>
Add to a sub package</td></tr>
</table>
</div>
<nav><ul>
<li><a href="#1">1</a></li>
<li><a href="#2">2</a></li>
<li><a href="#3">3</a></li>
<li><a href="#4">4</a></li>
<li><a href="#5">5</a></li>
<li><a href="#6">6</a></li>
<li><a href="#7">7</a></li>
<li><a href="#8">8</a></li>
<li><a href="#9">9</a></li>
<li><a href="#10">10</a></li>
<li><a href="#11">11</a></li>
<li> | </li>
<li><a href="#12">12</a></li>
<li><a href="#13">13</a></li>
<li><a href="#14">14</a></li>
<li><a href="#15">15</a></li>
<li><a href="#16">16</a></li>
<li><a href="#17">17</a></li>
<li> | </li>
<li><a href="#18">18</a></li>
<li class="current"><a href="#19">19</a></li>
<li><a href="#20">20</a></li>
<li><a href="#21">21</a></li>
<li> | </li>
<li><a href="#22">22</a></li>
<li><a href="#23">23</a></li>
</ul>
</nav>
</div>
<div class="slide" id="20"><header><h2>The crawl feature</h2>
</header>
<div class="content"><p>The service is up and running and you get an idea of adding
		a feature to package rebel for scanning the web for statements
		that the rebel can shout. It doesn't feel like the feature
		fits in the rebel package directly but will be used by
		it. Let's call the feature crawl, but where to put it?</p>
<table class="columns">
<tr><td><h3>1</h3>
Add it directly in package rebel<pre class="shell dark">$ tree rebel<br/>rebel
├── cmd
│   ├── rebel
│   │   └── main.go
│   └── rebelsrv
│       └── main.go
├── crawl.go
├── go.mod
├── phrase.go
├── rebel.go
├── rebel_test.go
└── service
    └── service.go

4 directories, 8 files
</pre><h4>Pros</h4>
<ul>
<li><em>Easy to edit initially</em></li>
</ul>
<h4>Cons</h4>
<ul>
<li>Tightly coupled with the rebel domain logic</li>
</ul>
</td><td><h3>2</h3>
Add it to an internal/crawl package<pre class="shell dark">$ tree rebel<br/>rebel
├── cmd
│   ├── rebel
│   │   └── main.go
│   └── rebelsrv
│       └── main.go
├── go.mod
├── internal
│   └── crawl
│       └── crawl.go
├── phrase.go
├── rebel.go
├── rebel_test.go
└── service
    └── service.go

6 directories, 8 files
</pre><h4>Pros</h4>
<ul>
<li>Decoupled from domain logic</li>
<li>Cannot be imported by modules outside of the rebel module</li>
</ul>
<h4>Cons</h4>
<ul>
<li>Can be imported by packages within this modules that you might want to move</li>
</ul>
</td><td><h3>3</h3>
Add to a sub package</td></tr>
</table>
</div>
<nav><ul>
<li><a href="#1">1</a></li>
<li><a href="#2">2</a></li>
<li><a href="#3">3</a></li>
<li><a href="#4">4</a></li>
<li><a href="#5">5</a></li>
<li><a href="#6">6</a></li>
<li><a href="#7">7</a></li>
<li><a href="#8">8</a></li>
<li><a href="#9">9</a></li>
<li><a href="#10">10</a></li>
<li><a href="#11">11</a></li>
<li> | </li>
<li><a href="#12">12</a></li>
<li><a href="#13">13</a></li>
<li><a href="#14">14</a></li>
<li><a href="#15">15</a></li>
<li><a href="#16">16</a></li>
<li><a href="#17">17</a></li>
<li> | </li>
<li><a href="#18">18</a></li>
<li><a href="#19">19</a></li>
<li class="current"><a href="#20">20</a></li>
<li><a href="#21">21</a></li>
<li> | </li>
<li><a href="#22">22</a></li>
<li><a href="#23">23</a></li>
</ul>
</nav>
</div>
<div class="slide" id="21"><header><h2>The crawl feature</h2>
</header>
<div class="content"><p>The service is up and running and you get an idea of adding
		a feature to package rebel for scanning the web for statements
		that the rebel can shout. It doesn't feel like the feature
		fits in the rebel package directly but will be used by
		it. Let's call the feature crawl, but where to put it?</p>
<table class="columns">
<tr><td><h3>1</h3>
Add it directly in package rebel<pre class="shell dark">$ tree rebel<br/>rebel
├── cmd
│   ├── rebel
│   │   └── main.go
│   └── rebelsrv
│       └── main.go
├── crawl.go
├── go.mod
├── phrase.go
├── rebel.go
├── rebel_test.go
└── service
    └── service.go

4 directories, 8 files
</pre><h4>Pros</h4>
<ul>
<li><em>Easy to edit initially</em></li>
</ul>
<h4>Cons</h4>
<ul>
<li>Tightly coupled with the rebel domain logic</li>
</ul>
</td><td><h3>2</h3>
Add it to an internal/crawl package<pre class="shell dark">$ tree rebel<br/>rebel
├── cmd
│   ├── rebel
│   │   └── main.go
│   └── rebelsrv
│       └── main.go
├── go.mod
├── internal
│   └── crawl
│       └── crawl.go
├── phrase.go
├── rebel.go
├── rebel_test.go
└── service
    └── service.go

6 directories, 8 files
</pre><h4>Pros</h4>
<ul>
<li>Decoupled from domain logic</li>
<li>Cannot be imported by modules outside of the rebel module</li>
</ul>
<h4>Cons</h4>
<ul>
<li>Can be imported by packages within this modules that you might want to move</li>
</ul>
</td><td><h3>3</h3>
Add to a sub package<pre class="shell dark">$ tree rebel<br/>rebel
├── cmd
│   ├── rebel
│   │   └── main.go
│   └── rebelsrv
│       └── main.go
├── crawl
│   └── crawl.go
├── go.mod
├── phrase.go
├── rebel.go
├── rebel_test.go
└── service
    └── service.go

5 directories, 8 files
</pre><h4>Pros</h4>
<ul>
<li>Decoupled from domain logic</li>
</ul>
<h4>Cons</h4>
<ul>
<li>You immediately need to be aware of it being importable</li>
</ul>
</td></tr>
</table>
</div>
<nav><ul>
<li><a href="#1">1</a></li>
<li><a href="#2">2</a></li>
<li><a href="#3">3</a></li>
<li><a href="#4">4</a></li>
<li><a href="#5">5</a></li>
<li><a href="#6">6</a></li>
<li><a href="#7">7</a></li>
<li><a href="#8">8</a></li>
<li><a href="#9">9</a></li>
<li><a href="#10">10</a></li>
<li><a href="#11">11</a></li>
<li> | </li>
<li><a href="#12">12</a></li>
<li><a href="#13">13</a></li>
<li><a href="#14">14</a></li>
<li><a href="#15">15</a></li>
<li><a href="#16">16</a></li>
<li><a href="#17">17</a></li>
<li> | </li>
<li><a href="#18">18</a></li>
<li><a href="#19">19</a></li>
<li><a href="#20">20</a></li>
<li class="current"><a href="#21">21</a></li>
<li> | </li>
<li><a href="#22">22</a></li>
<li><a href="#23">23</a></li>
</ul>
</nav>
</div>
<div class="slide" id="22"><header><h2>The team grows</h2>
</header>
<div class="content"><p>You've come a long way since that early <code>func
		main</code>.  The service is growing as Lisa finds new features
		to add. At some point you need to bring in more people to work
		on the service side. Initially you might start working in the
		same repository but down the road it may make more sense to
		split the service into it's own. The latter is what we're
		interested in. </p>
<table class="columns">
<tr><td><b>Let's go with option 2</b><pre class="shell dark">$ tree rebel<br/>rebel
├── cmd
│   ├── rebel
│   │   └── main.go
│   └── rebelsrv
│       └── main.go
├── go.mod
├── internal
│   └── crawl
│       └── crawl.go
├── phrase.go
├── rebel.go
├── rebel_test.go
└── service
    └── service.go

6 directories, 8 files
</pre></td><td><img src="rebelsrv.png"/></td><td><img src="rebelsrv2.png"/></td></tr>
</table>
</div>
<nav><ul>
<li><a href="#1">1</a></li>
<li><a href="#2">2</a></li>
<li><a href="#3">3</a></li>
<li><a href="#4">4</a></li>
<li><a href="#5">5</a></li>
<li><a href="#6">6</a></li>
<li><a href="#7">7</a></li>
<li><a href="#8">8</a></li>
<li><a href="#9">9</a></li>
<li><a href="#10">10</a></li>
<li><a href="#11">11</a></li>
<li> | </li>
<li><a href="#12">12</a></li>
<li><a href="#13">13</a></li>
<li><a href="#14">14</a></li>
<li><a href="#15">15</a></li>
<li><a href="#16">16</a></li>
<li><a href="#17">17</a></li>
<li> | </li>
<li><a href="#18">18</a></li>
<li><a href="#19">19</a></li>
<li><a href="#20">20</a></li>
<li><a href="#21">21</a></li>
<li> | </li>
<li class="current"><a href="#22">22</a></li>
<li><a href="#23">23</a></li>
</ul>
</nav>
</div>
<div class="slide" id="23"><header><h2>Final thoughts</h2>
</header>
<div class="content"><p>The design for change requires awareness of where we might
		end up in the future and selecting a route that enables it as
		frictionless as possible. Ie. if we'd selected <a href="#17">option 4</a> when
		adding the service, the move at the end would have been even
		easier at the expense of mixing service logic with command
		logic. Depending on the service this may be a good tradeof.</p>
<img src="rebelsrvok.png"/></div>
<nav><ul>
<li><a href="#1">1</a></li>
<li><a href="#2">2</a></li>
<li><a href="#3">3</a></li>
<li><a href="#4">4</a></li>
<li><a href="#5">5</a></li>
<li><a href="#6">6</a></li>
<li><a href="#7">7</a></li>
<li><a href="#8">8</a></li>
<li><a href="#9">9</a></li>
<li><a href="#10">10</a></li>
<li><a href="#11">11</a></li>
<li> | </li>
<li><a href="#12">12</a></li>
<li><a href="#13">13</a></li>
<li><a href="#14">14</a></li>
<li><a href="#15">15</a></li>
<li><a href="#16">16</a></li>
<li><a href="#17">17</a></li>
<li> | </li>
<li><a href="#18">18</a></li>
<li><a href="#19">19</a></li>
<li><a href="#20">20</a></li>
<li><a href="#21">21</a></li>
<li> | </li>
<li><a href="#22">22</a></li>
<li class="current"><a href="#23">23</a></li>
</ul>
</nav>
</div>
<script>function enhance() {
    // if there is no hash, start with the first slide
    var hash = window.location.hash;
    if (hash == "") {
	window.location += "#1"
	return
    }

    // handle clicks on slide changes
    window.onhashchange = toggleSlide;

    hash = hash.substring(1) // ignore the #
    var slides = document.getElementsByClassName("slide");
    for (var i = 0; i < slides.length; i++) {
	var s = slides.item(i);

	// hide all but the hashed one	
	if (s.id != hash) {
	    s.style.display = 'none';
	} else {
	    s.style.diplay = 'block';
	}
    }
}

var currentHash = window.location.hash;

function toggleSlide() {
    var c = document.getElementById(currentHash.substring(1));
    c.style.display = 'none';
    var n = document.getElementById(window.location.hash.substring(1))
    n.style.display = 'block';
    currentHash = window.location.hash;
}



enhance()
</script>
</body>
</html>
